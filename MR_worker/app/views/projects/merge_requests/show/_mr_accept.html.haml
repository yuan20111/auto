- unless @allowed_to_merge
  - if @project.archived?
    %p
      %strong Archived projects cannot be committed to!
  - else
    .automerge_widget.cannot_be_merged.hide
      %strong This can't be merged automatically, even if it could be merged you don't have the permission to do so.
    - if !(@project.pam_enabled or @project.am_enabled)
      .automerge_widget.can_be_merged.hide
        %strong This can be merged automatically but you don't have the permission to do so.


- if @show_merge_controls
  .automerge_widget.can_be_merged.hide
    .clearfix
      = form_for [:automerge, @project, @merge_request], remote: true, method: :post do |f|
        .accept-merge-holder.clearfix.js-toggle-container
          .accept-action
            = f.submit "Accept Merge Request", class: "btn btn-create accept_merge_request"
          - if(@project.pam_enabled or @project.am_enabled)
            %p#automerge_true
              = " "
          - if !(@merge_request.check_user_power?(current_user))
            %p#check_user_power
              = " "
          - if can_remove_branch?(@merge_request.source_project, @merge_request.source_branch) && !@merge_request.for_fork?
            .accept-control
              = label_tag :should_remove_source_branch, class: "remove_source_checkbox" do
                = check_box_tag :should_remove_source_branch
                Remove source-branch
          .accept-control
            = link_to "#", class: "modify-merge-commit-link js-toggle-button", title: "Modify merge commit message" do
              %i.fa.fa-edit
              Modify commit message
          .js-toggle-content.hide.prepend-top-20
            = render 'shared/commit_message_container', params: params,
                text: @merge_request.merge_commit_message,
                rows: 14, hint: true

        %hr
        .light
          If you still want to merge this request manually - use
          %strong
            = link_to "command line", "#modal_merge_info", class: "how_to_merge_link vlink", title: "How To Merge", "data-toggle" => "modal"


  .automerge_widget.no_satellite.hide
    %p
      %span
        %strong This repository does not have satellite. Ask an administrator to fix this issue

  .automerge_widget.cannot_be_merged.hide
    %h4
      This request can't be merged with GitLab.
      You should do it manually with
      %strong
        = link_to "#modal_merge_info", class: "underlined-link how_to_merge_link", title: "How To Merge", "data-toggle" => "modal" do
          command line

    %p
      %button.btn.disabled
        %i.fa.fa-warning
        Accept Merge Request
      &nbsp;
      This usually happens when git can not resolve conflicts between branches automatically.

  .automerge_widget.unchecked
    %p
      %strong
        %i.fa.fa-spinner.fa-spin
        Checking for ability to automatically merge…

  .automerge_widget.already_cannot_be_merged.hide
    %p
      %strong This merge request can not be merged. Try to reload the page.

  .merge-in-progress.hide
    %p
      %i.fa.fa-spinner.fa-spin
      &nbsp;
      Merge is in progress. Please wait. Page will be automatically reloaded. &nbsp;

:javascript
  $(window).load(function() {
    $(".accept_merge_request").attr("disabled", false);
    if(document.getElementById("automerge_true").id == "automerge_true"){
      if("#{@merge_request.assignee.name}" == "MR_admin" ){
        setTimeout(function (){
          $(".accept_merge_request").click();
        }, 2000);
      }else{
        if(document.getElementById("check_user_power").id == "check_user_power"){
          $('.mr-error').remove();
          $(".accept_merge_request").hide();
          $(".accept_merge_request").after("<span class='mr-error' style='color:rgb(255, 0, 0)'>如果需要集成到版本中，请将Assignee设置为MR_admin,并刷新页面！</span>");
        }
      }
    }
  });
